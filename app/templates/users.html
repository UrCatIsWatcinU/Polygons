{% extends "layout.html" %}

{% block content %}
    <h1>Users</h1>
    <ol class="users">
        {% for user_in_list in users %}
            <li>
                <div class="user-in-list" id='u{{user_in_list.id}}'>
                    <div class="user-in-list-info">
                        <span class="role">{{ user_in_list.role.name }}</span>
                        <a href="{{ url_for('user', id=user_in_list.id) }}" class="username">{{ user_in_list.username }}</a>
                        <span class="email">{{ user_in_list.email }}</span>
                    </div>
                    <span class="rating">{{ user_in_list.get_rating() }}</span>
                </div>
            </li>
            {% if user.role.name == 'admin' %}
                <button class="user-delete">Delete</button>
            {% endif %}
        {% endfor %}  
        </ol>
    <style>
        @media (max-width: 580px){
            button{
                margin: 5px;
            }
        }
    </style>
    <script>
        document.querySelectorAll('.user-delete').forEach(btn => {
            btn.onclick = (evt) => {
                fetch('/users/delete/' + evt.target.parentElement.id, {
                    method: 'DELETE'
                });

                evt.target.parentElement.remove();
            }
        });
    </script>
{% endblock %}